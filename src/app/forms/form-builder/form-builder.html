<div class="container my-4">

  <!-- Toast Container -->
  <p-toast></p-toast>

  <!-- Top Button -->
  <div class="mb-3">
    <p-button label="Create Mini Form" icon="pi pi-plus" class="p-button-info" (click)="goToMiniForm()"></p-button>
  </div>

  <!-- Page Heading -->
  <h2 class="mb-4 text-center text-white">
    {{ editId !== null ? 'Edit Dynamic Form' : 'Dynamic Form Builder' }}
  </h2>

  <form [formGroup]="dynamicForm" (ngSubmit)="onSubmit()">

    <!-- Form Fields -->
    <div formArrayName="fields">
      <div *ngFor="let field of fields.controls; let i = index" [formGroupName]="i" class="mb-3">
        
        <p-card header="Field #{{ i + 1 }}" class="custom-card">
          <!-- Label Input -->
          <div class="mb-2">
            <label class="form-label">{{ ('Field ' + (i + 1)) + ':' | capitalize }}</label>
            <input
              type="text"
              formControlName="label"
              class="form-control"
              placeholder="Enter field label"
              [appHighlightInvalid]="!!(field.get('label')?.invalid && field.get('label')?.touched)"
            />
            <div class="text-danger mt-1" *ngIf="field.get('label')?.errors && field.get('label')?.touched">
              <small *ngIf="field.get('label')?.errors?.['required']">Label is required</small>
              <small *ngIf="field.get('label')?.errors?.['minlength']">Label must be at least 3 characters</small>
            </div>
          </div>

          <!-- Value Input -->
          <div class="mb-2">
            <label class="form-label">Value:</label>
            <input
              type="text"
              formControlName="value"
              class="form-control"
              placeholder="Enter value"
              [appHighlightInvalid]="!!(field.get('value')?.invalid && field.get('value')?.touched)"
            />
            <div class="text-danger mt-1" *ngIf="field.get('value')?.errors && field.get('value')?.touched">
              <small *ngIf="field.get('value')?.errors?.['required']">Value is required</small>
            </div>
          </div>

          <!-- Remove Button -->
          <div class="d-flex justify-content-end">
            <p-button
              label="Remove"
              icon="pi pi-trash"
              class="p-button-sm"
              (click)="removeField(i)"
            ></p-button>
          </div>

        </p-card>
      </div>
    </div>

    <!-- Duplicate Label Validation -->
    <div *ngIf="dynamicForm.errors?.['duplicateLabel']" class="alert alert-warning">
      ‚ùó Each label must be unique.
    </div>

    <!-- Form Actions -->
    <div class="d-flex gap-2 mt-3 justify-content-center">
      <p-button label="‚ûï Add Field" icon="pi pi-plus" class="p-button-success" (click)="addField()"></p-button>
      <p-button
        label="üíæ Save"
        icon="pi pi-check"
        class="p-button-primary"
        [disabled]="dynamicForm.invalid"
        type="submit"
      ></p-button>
    </div>

  </form>

  <hr />

  <!-- Lifecycle Demo -->
  <app-lifecycle-demo [demoValue]="dynamicForm.value | json"></app-lifecycle-demo>
</div>
