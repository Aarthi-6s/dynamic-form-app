<div style="margin-top: 32px; margin-left: 32px; width: fit-content;">
  <p-button label="Back" icon="pi pi-arrow-left" class="mb-3" (click)="goBack()"></p-button>
</div>

<h2 class="mb-4 text-white text-center">Saved Forms</h2>

<p-toast></p-toast>

<ng-container *ngIf="(forms$ | async) as forms">
  <!-- Empty State -->
  <div *ngIf="forms.length === 0" class="empty p-3 text-center text-white">
    <p>No forms created yet!</p>
    <a routerLink="/forms" class="p-button p-component p-button-text">Create a new form</a><br />
    <a routerLink="/forms/mini" class="p-button p-component p-button-text mt-2">Create Mini Form</a>
  </div>

  <!-- Forms List -->
  <div *ngIf="forms.length > 0" class="p-grid">
    <div *ngFor="let form of forms; let i = index" class="p-col-12 p-md-6 p-lg-4 mb-3">
      <p-card header="Form #{{ i + 1 }}" class="custom-card text-white">

        <!-- Form Fields -->
        <ul class="list-unstyled">
          <ng-container *ngIf="form.fields; else miniFormFields">
            <li *ngFor="let field of form.fields">
              <strong>{{ field.label }}:</strong> {{ field.value }}
            </li>
          </ng-container>

          <ng-template #miniFormFields>
            <li><strong>Name:</strong> {{ form.name }}</li>
            <li><strong>Email:</strong> {{ form.email }}</li>
            <li><strong>Age:</strong> {{ form.age }}</li>
            <li><strong>Phone:</strong> {{ form.phone }}</li>
            <li><strong>Country:</strong> {{ form.country }}</li>
            <li><strong>Gender:</strong> {{ form.gender }}</li>
          </ng-template>
        </ul>

        <!-- Action Buttons -->
        <div class="mt-3 d-flex gap-2">
          <!-- âœ… View Details navigates correctly -->
          <p-button
            label="View Details"
            icon="pi pi-eye"
            [routerLink]="['/forms/detail', i]"
          ></p-button>

          <p-button
            label="Edit"
            icon="pi pi-pencil"
            (click)="editForm(i)"
          ></p-button>

          <p-button
            label="Delete"
            icon="pi pi-trash"
            (click)="showDeleteDialog(i)"
          ></p-button>
        </div>

      </p-card>
    </div>
  </div>
</ng-container>

<!-- Delete Confirmation Dialog -->
<p-dialog header="Confirm Delete" [(visible)]="displayDelete" modal="true" [closable]="false" [style]="{width: '350px'}">
  <p>Are you sure you want to delete this form?</p>
  <div class="d-flex justify-content-end gap-2 mt-3">
    <p-button label="Cancel" (click)="displayDelete=false"></p-button>
    <p-button label="Yes, Delete" (click)="confirmDelete()"></p-button>
  </div>
</p-dialog>
